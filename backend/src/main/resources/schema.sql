create table agendamento_servico (agendamento_id bigint not null, servico_id bigint not null, primary key (agendamento_id, servico_id));
create table agendamentos (cliente_id bigint not null, data_agendamento timestamp(6), id_agendamento bigint generated by default as identity, tecnico_id bigint not null, observacoes varchar(255), status enum ('AGENDADO','CANCELADO','CONCLUIDO','EM_ANDAMENTO'), primary key (id_agendamento));
create table clientes (data_cadastro timestamp(6), id_cliente bigint generated by default as identity, email varchar(255), endereco varchar(255), nome varchar(255), telefone varchar(255), primary key (id_cliente));
create table servicos (tempo_estimado integer, valor_estimado numeric(38,2), id_servico bigint generated by default as identity, categoria varchar(255), descricao varchar(255), primary key (id_servico));
create table tecnicos (data_contratacao timestamp(6), id_tecnico bigint generated by default as identity, email varchar(255), especialidade varchar(255), nome varchar(255), telefone varchar(255), primary key (id_tecnico));
alter table if exists agendamento_servico add constraint FK1btjq9qb0hwkvyv9lo1kqym5i foreign key (servico_id) references servicos;
alter table if exists agendamento_servico add constraint FKpxgov7cq0pg5srw6px678u65g foreign key (agendamento_id) references agendamentos;
alter table if exists agendamentos add constraint FK7j02h7ufegbom5ke8ydlafx0x foreign key (cliente_id) references clientes;
alter table if exists agendamentos add constraint FKa1daefnp1hqyd7ob4jbv60lry foreign key (tecnico_id) references tecnicos;
create table agendamento_servico (agendamento_id bigint not null, servico_id bigint not null, primary key (agendamento_id, servico_id));
create table agendamentos (uf varchar(2) not null, cliente_id bigint not null, data_agendamento timestamp(6) not null, id_agendamento bigint generated by default as identity, tecnico_id bigint not null, cep varchar(20) not null, numero varchar(50) not null, bairro varchar(100) not null, cidade varchar(100) not null, complemento varchar(255) not null, logradouro varchar(255) not null, observacoes varchar(255), status enum ('AGENDADO','CANCELADO','CONCLUIDO','EM_ANDAMENTO','TECNICO_A_CAMINHO','TECNICO_CHEGOU') not null, primary key (id_agendamento));
create table apuracoes_servico (km_deslocamento integer not null, receita_liquida numeric(19,2) not null, valor_materiais numeric(19,2) not null, valor_servico numeric(19,2) not null, data_apuracao timestamp(6) not null, id bigint generated by default as identity, ordem_servico_id bigint not null, primary key (id));
create table categorias_financeiras (id bigint generated by default as identity, descricao varchar(255), nome varchar(255) not null unique, primary key (id));
create table clientes (data_cadastro timestamp(6), id_cliente bigint generated by default as identity, telefone varchar(50) not null, email varchar(255) not null unique, endereco varchar(255) not null, nome varchar(255) not null, origem varchar(255), primary key (id_cliente));
create table contas_caixa (saldo_inicial numeric(19,2) not null, id bigint generated by default as identity, nome varchar(255) not null unique, primary key (id));
create table lancamentos_financeiros (valor numeric(19,2) not null, categoria_financeira_id bigint not null, conta_caixa_id bigint not null, data_lancamento timestamp(6) not null, id bigint generated by default as identity, descricao varchar(255), tipo_transacao enum ('DESPESA','RECEITA') not null, primary key (id));
create table movimentacoes_estoque (quantidade integer not null check (quantidade>=1), data_movimentacao timestamp(6) not null, id bigint generated by default as identity, produto_id bigint not null, descricao varchar(255), tipo enum ('ENTRADA','SAIDA') not null, primary key (id));
create table ordens_servico (avaliacao float(53), km_deslocamento integer not null check (km_deslocamento>=0), valor_materiais numeric(19,2) not null, valor_servico numeric(19,2) not null, agendamento_id bigint not null, data_criacao timestamp(6), data_realizacao timestamp(6), id bigint generated by default as identity, observacoes varchar(255), status enum ('AGENDADA','ASSINADA','CANCELADA','CONCLUIDA','EM_ANDAMENTO','RECUSADA') not null, primary key (id));
create table pecas_utilizadas (quantidade integer not null check (quantidade>=1), id bigint generated by default as identity, ordem_servico_id bigint not null, produto_id bigint not null, descricao varchar(255), primary key (id));
create table produtos (quantidade_estoque integer not null check (quantidade_estoque>=0), id bigint generated by default as identity, descricao varchar(255), nome varchar(255) not null unique, primary key (id));
create table roles (id_role bigint generated by default as identity, nome_role varchar(50) not null unique, descricao varchar(100), primary key (id_role));
create table servicos (tempo_estimado integer not null check (tempo_estimado>=1), valor_estimado float(53) not null, servico_id bigint generated by default as identity, categoria varchar(255) not null, descricao varchar(255) not null, primary key (servico_id));
create table tecnico_roles (role_id bigint not null, tecnico_id bigint not null, primary key (role_id, tecnico_id));
create table tecnicos (data_contratacao timestamp(6) not null, tecnico_id bigint generated by default as identity, telefone varchar(50) not null, email varchar(255) not null unique, especialidade varchar(255) not null, nome varchar(255) not null, senha varchar(255) not null, primary key (tecnico_id));
alter table if exists agendamento_servico add constraint FK1btjq9qb0hwkvyv9lo1kqym5i foreign key (servico_id) references servicos;
alter table if exists agendamento_servico add constraint FKpxgov7cq0pg5srw6px678u65g foreign key (agendamento_id) references agendamentos;
alter table if exists agendamentos add constraint FK7j02h7ufegbom5ke8ydlafx0x foreign key (cliente_id) references clientes;
alter table if exists agendamentos add constraint FKa1daefnp1hqyd7ob4jbv60lry foreign key (tecnico_id) references tecnicos;
alter table if exists apuracoes_servico add constraint FKimel4741tisfe8hl4b4cq4e7a foreign key (ordem_servico_id) references ordens_servico;
alter table if exists lancamentos_financeiros add constraint FKtabif6tssyt7bnj8j2m16dfm6 foreign key (categoria_financeira_id) references categorias_financeiras;
alter table if exists lancamentos_financeiros add constraint FKkoh4evso2idbvlk385sqlu95y foreign key (conta_caixa_id) references contas_caixa;
alter table if exists movimentacoes_estoque add constraint FKmdn52qx0fmc71ejys5cmetpjc foreign key (produto_id) references produtos;
alter table if exists ordens_servico add constraint FKo4x5b9kgxol1bp0ovngx3kqw7 foreign key (agendamento_id) references agendamentos;
alter table if exists pecas_utilizadas add constraint FKfwjox36pga2txg49rt18230us foreign key (ordem_servico_id) references ordens_servico;
alter table if exists pecas_utilizadas add constraint FKdt34q000qo55q2pjo6ydpsuk2 foreign key (produto_id) references produtos;
alter table if exists tecnico_roles add constraint FKroq60yj3m3s5u4p19g6ykek1i foreign key (role_id) references roles;
alter table if exists tecnico_roles add constraint FK6cm4v73lirr1g888eqqe4y35b foreign key (tecnico_id) references tecnicos;
